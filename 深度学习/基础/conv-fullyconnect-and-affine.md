
#### 卷积  

假设有这样的卷积操作：
$$\left( \begin{array}{lll}{a_{11}} & {a_{12}} & {a_{13}} \\ {a_{21}} & {a_{22}} & {a_{23}} \\ {a_{31}} & {a_{32}} & {a_{33}}\end{array}\right) * \left( \begin{array}{cc}{w_{11}} & {w_{12}} \\ {w_{21}} & {w_{22}}\end{array}\right)=\left( \begin{array}{cc}{z_{11}} & {z_{12}} \\ {z_{21}} & {z_{22}}\end{array}\right)$$  

计算过程：
$$z_{11}=a_{11} w_{11}+a_{12} w_{12}+a_{21} w_{21}+a_{22} w_{22}$$  
$$
z_{12}=a_{12} w_{11}+a_{13} w_{12}+a_{22} w_{21}+a_{23} w_{22}
$$  
$$
z_{21}=a_{21} w_{11}+a_{22} w_{12}+a_{31} w_{21}+a_{32} w_{22}
$$
$$
z_{22}=a_{22} w_{11}+a_{23} w_{12}+a_{32} w_{21}+a_{33} w_{22}
$$

#### 全连接  

而全连接层则是这样的（这里用和上面一样的下标便于对比）：
假设输入为 $ ( a_{11},a_{12},a_{21},a_{22} )$, 输出为 $z_{11}$,那么权重就只有四个值 $(w_{11},w_{12},w_{21},w_{22})$
计算过程为:
$$z_{11}=a_{11} w_{11}+a_{12} w_{12}+a_{21} w_{21}+a_{22} w_{22}$$  

所以可以将卷积层视为特殊权重的全连接层组成的。  
以输入为$(a_{11},a_{12},a_{13},a_{21},a_{22},a_{23},a_{31},a_{32},a_{33})$，输出为$z_{11}$为例，
则权重为： $(w_{11},w_{12},0, w_{21},w_{22},0, 0,0,0)$
也可以将全连接层视为多个输出通道的卷积层，卷积核的尺寸和输入相同，输出通道数和全连接层的输出数量相同。  

关于卷积层的实现,可以参考：https://github.com/imhuay/Algorithm_Interview_Notes-Chinese/blob/master/A-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/B-%E4%B8%93%E9%A2%98-CNN.md  

#### 仿射变换  

[affine/linear(仿射/线性)变换函数详解及全连接层反向传播的梯度求导](https://blog.csdn.net/oBrightLamp/article/details/84333111)  


所以可以用卷积层实现仿射变换，卷积核的大小和输入图像尺寸相同，卷积核的数量和输入图像的面积相同（即，每个输出通道对应图像上的一个点）。  
问题是这样运算量太大。  



#### 图像的仿射变换  

我们通常对图像做的仿射变换其实是对图像坐标的仿射变换，并不是直接对图像像素值做仿射变换。而图像坐标是二维向量（图像像素值组成的向量是一个高维向量），所以对坐标的仿射变换不会有太大计算量和参数量。  


>设想：如果我们把仿射变换作为一个层放入神经网络，将变换参数设置为可学习的，这样多个并列的仿射变换层就能使网络拥有**旋转不变性和尺度不变性**。  

对于仿射变换层，之前已经有 [空间变换网络](https://blog.csdn.net/u011961856/article/details/77920970/)  

>猜想：图像坐标仿射变换是图像像素向量仿射变换的一个子集（比如，两个像素交换位置相当于对像素向量进行旋转）。如果能用这个特性大幅减少像素变换的计算量，就方便将其加入神经网络。





**相关**  
[1] [CNN对位移、尺度和旋转不变性的讨论](https://www.cnblogs.com/dingz/p/9259298.html)  
[2] [空间变换网络](https://blog.csdn.net/u011961856/article/details/77920970/)  

**参考**
[1] [卷积神经网络(CNN)反向传播算法](https://www.cnblogs.com/pinard/p/6494810.html)  
[2] [opencv学习(三十五)之仿射变换warpAffine](https://blog.csdn.net/keith_bb/article/details/56331356)  